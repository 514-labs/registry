{
  "$schema": "https://schemas.connector-factory.dev/scaffold.schema.json",
  "scaffold": "typescript",
  "version": "0.6.0",
  "description": "TypeScript implementation scaffold with _meta folder at implementation level.",
  "variables": {
    "connector": {
      "description": "Connector name (kebab-case).",
      "example": "stripe",
      "pattern": "^[a-z0-9][a-z0-9-]*$"
    },
    "version": {
      "description": "Source version identifier (not necessarily semver). Examples: v4, ga4, 2020-08-27, api-2020.08.27",
      "example": "v4",
      "pattern": "^[A-Za-z0-9][A-Za-z0-9._-]*$"
    },
    "author": {
      "description": "GitHub organization or user handle (kebab-case). Used for linking and avatars.",
      "example": "514-labs",
      "pattern": "^[a-z0-9](?:[a-z0-9-]{0,37}[a-z0-9])?$"
    },
    "implementation": {
      "description": "Implementation name nested under the language folder (kebab-case). Defaults to 'default'.",
      "example": "default",
      "pattern": "^[a-z0-9][a-z0-9-]*$",
      "default": "default"
    },
    "packageName": {
      "description": "npm package name for the connector (use @workspace/ prefix if publishing in this monorepo).",
      "example": "@workspace/connector-stripe",
      "pattern": "^(@[a-z0-9-~][a-z0-9-._~]*)?/[a-z0-9-~][a-z0-9-._~]*$|^[a-z0-9-~][a-z0-9-._~]*$"
    },
    "resource": {
      "description": "Default REST resource path segment (kebab-case).",
      "example": "contacts",
      "pattern": "^[a-z0-9][a-z0-9-]*$",
      "default": "resource"
    }
  },
  "structure": [
    {
      "type": "dir",
      "name": "{connector}",
      "children": [
        {
          "type": "dir",
          "name": "{version}",
          "children": [
            {
              "type": "dir",
              "name": "{author}",
              "children": [
                {
                  "type": "dir",
                  "name": "typescript",
                  "children": [
                    {
                      "type": "dir",
                      "name": "{implementation}",
                      "children": [
                        {
                          "type": "dir",
                          "name": "_meta",
                          "children": [
                            {
                              "type": "file",
                              "name": "connector.json",
                              "template": "{\n  \"$schema\": \"https://schemas.connector-factory.dev/connector.schema.json\",\n  \"identifier\": \"{connector}\",\n  \"name\": \"{connector}\",\n  \"author\": \"{author}\",\n  \"authorType\": \"organization\",\n  \"avatarUrlOverride\": \"\",\n  \"version\": \"{version}\",\n  \"language\": \"typescript\",\n  \"implementation\": \"{implementation}\",\n  \"tags\": [],\n  \"category\": \"api\",\n  \"description\": \"\",\n  \"homepage\": \"\",\n  \"license\": \"MIT\",\n  \"source\": {\"type\":\"api\",\"spec\":\"\"},\n  \"capabilities\": {\"extract\": true, \"transform\": true, \"load\": true},\n  \"maintainers\": [],\n  \"issues\": \"\",\n  \"registryUrl\": \"https://github.com/514-labs/factory/tree/main/connector-registry/{connector}/{version}/{author}/typescript/{implementation}\"\n}\n"
                            },
                            {
                              "type": "file",
                              "name": "README.md",
                              "template": "# {connector}\n\n> Maintained by {author}\n\nConnector metadata and assets for the TypeScript {implementation} implementation.\n"
                            },
                            {
                              "type": "file",
                              "name": "CHANGELOG.md",
                              "template": "# Changelog\n\nAll notable changes to `{connector}` TypeScript {implementation} implementation by `{author}`.\n\n## [0.1.0] - Initial Release\n\n- Initial connector implementation\n"
                            },
                            { "type": "file", "name": "LICENSE", "template": "MIT\n" },
                            { "type": "dir", "name": "assets" }
                          ]
                        },
                        {
                          "type": "file",
                          "name": ".gitignore",
                          "template": "node_modules/\ndist/\n.env\n"
                        },
                        {
                          "type": "file",
                          "name": ".env.example",
                          "template": "API_KEY=\n"
                        },
                        {
                          "type": "file",
                          "name": "README.md",
                          "template": "# {connector} (TypeScript)\n\nTypeScript implementation for `{connector}` by `{author}`.\n\nSchemas: see `schemas/index.json` for machine-readable definitions and accompanying Markdown docs.\n"
                        },
                        {
                          "type": "file",
                          "name": "package.json",
                          "template": "{\n  \"name\": \"{packageName}\",\n  \"version\": \"0.1.0\",\n  \"private\": true,\n  \"type\": \"module\",\n  \"main\": \"dist/index.js\",\n  \"types\": \"dist/index.d.ts\",\n  \"scripts\": {\n    \"build\": \"tsup src/index.ts --dts --format esm,cjs\",\n    \"test\": \"vitest run\"\n  },\n  \"engines\": {\"node\": \">=20\"},\n  \"dependencies\": {},\n  \"devDependencies\": {\n    \"tsup\": \"^8.0.0\",\n    \"typescript\": \"^5.4.0\",\n    \"vitest\": \"^1.6.0\"\n  }\n}\n"
                        },
                        {
                          "type": "file",
                          "name": "tsconfig.json",
                          "template": "{\n  \"compilerOptions\": {\n    \"target\": \"ES2022\",\n    \"module\": \"ESNext\",\n    \"moduleResolution\": \"Bundler\",\n    \"outDir\": \"dist\",\n    \"declaration\": true,\n    \"declarationMap\": true,\n    \"strict\": true,\n    \"skipLibCheck\": true\n  },\n  \"include\": [\"src\"]\n}\n"
                        },
                        {
                          "type": "file",
                          "name": "vitest.config.ts",
                          "template": "import { defineConfig } from 'vitest/config'\nexport default defineConfig({ test: { environment: 'node' } })\n"
                        },
                        {
                          "type": "dir",
                          "name": "docs",
                          "children": [
                            {
                              "type": "file",
                              "name": "getting-started.md",
                              "template": "# Getting started\n\nThis is a placeholder. Document how to configure and run the connector in TypeScript.\n"
                            },
                            {
                              "type": "file",
                              "name": "configuration.md",
                              "template": "# Configuration\n\nDocument configuration options (auth, scopes, IDs).\n"
                            },
                            {
                              "type": "file",
                              "name": "schema.md",
                              "template": "# Schema\n\nRefer to `schemas/index.json` and related files.\n\n## Organization\n\nSchemas support nested folder structures for better organization:\n\n- **raw/** - Raw API schemas\n  - `endpoints/` - API endpoint request/response schemas\n  - `types/` - Shared type definitions for endpoints (not shown as Files)\n  - `events/` - Event payloads\n- **extracted/** - Normalized schemas\n  - `entities/` - Business entities\n  - `metrics/` - Aggregated data\n- **files/** - File-based schemas (CSV/JSON/Parquet/Avro/NDJSON). Only items under `schemas/files` appear in the Files tab.\n\n## Adding Schemas\n\n1. Create schema files in appropriate nested folders\n2. Update `schemas/index.json` with correct paths for endpoints and tables\n3. Place file schemas under `schemas/files` (no index entries needed)\n"
                            },
                            {
                              "type": "file",
                              "name": "limits.md",
                              "template": "# Limits\n\nDescribe API limits, quotas, and rate limiting behavior.\n"
                            }
                          ]
                        },
                        {
                          "type": "dir",
                          "name": "schemas",
                          "children": [
                            {
                              "type": "file",
                              "name": "index.json",
                              "template": "{\n  \"$schema\": \"https://schemas.connector-factory.dev/schema-index.schema.json\",\n  \"version\": \"0.1.0\",\n  \"datasets\": [\n    {\n      \"name\": \"events\",\n      \"stage\": \"raw\",\n      \"kind\": \"endpoints\",\n      \"path\": \"raw/endpoints/events.schema.json\",\n      \"doc\": \"raw/endpoints/events.md\"\n    },\n    {\n      \"name\": \"events\",\n      \"stage\": \"extracted\",\n      \"kind\": \"endpoints\",\n      \"path\": \"extracted/endpoints/events.schema.json\",\n      \"doc\": \"extracted/endpoints/events.md\"\n    }\n  ],\n  \"_examples\": {\n    \"_comment\": \"Below are examples of how to use nested folders. Copy and modify these patterns:\",\n    \"endpoint_example\": {\n      \"name\": \"users.create\",\n      \"stage\": \"raw\",\n      \"kind\": \"endpoints\",\n      \"path\": \"raw/endpoints/endpoints/users/create.schema.json\",\n      \"doc\": \"raw/endpoints/endpoints/users/create.md\",\n      \"metadata\": {\n        \"category\": \"endpoint\",\n        \"apiMethod\": \"POST\"\n      }\n    },\n    \"nested_organization_example\": {\n      \"name\": \"reports.analytics\",\n      \"stage\": \"raw\",\n      \"kind\": \"endpoints\",\n      \"path\": \"raw/endpoints/endpoints/reports/analytics.schema.json\",\n      \"doc\": \"raw/endpoints/endpoints/reports/analytics.md\"\n    }\n  }\n}\n"
                            },
                            {
                              "type": "dir",
                              "name": "raw",
                              "children": [
                                {
                                  "type": "dir",
                                  "name": "json",
                                  "children": [
                                    {
                                      "type": "file",
                                      "name": "README.md",
                                      "template": "# Raw JSON Schemas\n\nThis directory contains raw JSON schemas from the source API.\n\n## Organization\n\nSchemas can be organized in nested folders for better structure:\n- `endpoints/` - API endpoint request/response schemas\n- `types/` - Shared type definitions\n- `events/` - Event or webhook payloads\n- Or any logical grouping that makes sense for your connector\n\n## Example Structure\n\n```\njson/\n├── endpoints/\n│   ├── users.schema.json\n│   └── users.md\n├── types/\n│   ├── User.schema.json\n│   └── User.md\n└── events.schema.json\n```\n"
                                    },
                                    {
                                      "type": "file",
                                      "name": "events.schema.json",
                                      "template": "{\\n  \\\"$schema\\\": \\\"http://json-schema.org/draft-07/schema#\\\",\\n  \\\"title\\\": \\\"Raw Event\\\",\\n  \\\"type\\\": \\\"object\\\",\\n  \\\"additionalProperties\\\": true\\n}\\n"
                                    },
                                    {
                                      "type": "file",
                                      "name": "events.md",
                                      "template": "# Raw events (JSON)\n\nDescribe the upstream event payload.\n"
                                    }
                                  ]
                                },
                                {
                                  "type": "dir",
                                  "name": "files",
                                  "children": [
                                    {
                                      "type": "file",
                                      "name": "README.md",
                                      "template": "# File schemas\n\nPlace file-based schemas here (CSV/JSON/Parquet/Avro/NDJSON). Files in this folder are shown in the Files tab.\n\nExamples:\n- `events.csv`\n- `events.schema.json` (with title/description)\n"
                                    }
                                  ]
                                },
                                {
                                  "type": "dir",
                                  "name": "relational",
                                  "children": [
                                    {
                                      "type": "file",
                                      "name": "tables.json",
                                      "template": "{\\n  \\\"tables\\\": []\\n}\\n"
                                    },
                                    {
                                      "type": "file",
                                      "name": "tables.sql",
                                      "template": "-- DDL placeholders for raw tables\n"
                                    },
                                    {
                                      "type": "file",
                                      "name": "README.md",
                                      "template": "# Raw relational schema\n\nDescribe tables and relationships.\n"
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "type": "dir",
                              "name": "extracted",
                              "children": [
                                {
                                  "type": "dir",
                                  "name": "json",
                                  "children": [
                                    {
                                      "type": "file",
                                      "name": "README.md",
                                      "template": "# Extracted JSON Schemas\n\nThis directory contains normalized/transformed JSON schemas.\n\n## Organization\n\nLike raw schemas, extracted schemas can be organized in nested folders:\n- `entities/` - Normalized business entities\n- `metrics/` - Calculated metrics or aggregations\n- `reports/` - Structured report schemas\n- Or any logical grouping for your transformed data\n\n## Naming Convention\n\nUse the same folder structure as in `raw/endpoints/` when there's a 1:1 mapping, or create new logical groupings for transformed data.\n"
                                    },
                                    {
                                      "type": "file",
                                      "name": "events.schema.json",
                                      "template": "{\\n  \\\"$schema\\\": \\\"http://json-schema.org/draft-07/schema#\\\",\\n  \\\"title\\\": \\\"Extracted Event\\\",\\n  \\\"type\\\": \\\"object\\\",\\n  \\\"additionalProperties\\\": false,\\n  \\\"properties\\\": {}\\n}\\n"
                                    },
                                    {
                                      "type": "file",
                                      "name": "events.md",
                                      "template": "# Extracted events (JSON)\n\nDescribe the normalized event shape.\n"
                                    }
                                  ]
                                },
                                {
                                  "type": "dir",
                                  "name": "relational",
                                  "children": [
                                    {
                                      "type": "file",
                                      "name": "tables.json",
                                      "template": "{\\n  \\\"tables\\\": []\\n}\\n"
                                    },
                                    {
                                      "type": "file",
                                      "name": "tables.sql",
                                      "template": "-- DDL placeholders for extracted tables\n"
                                    },
                                    {
                                      "type": "file",
                                      "name": "README.md",
                                      "template": "# Extracted relational schema\n\nDescribe normalized tables and relationships.\n"
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "type": "dir",
                          "name": "src",
                          "children": [
                            {
                              "type": "file",
                              "name": "index.ts",
                              "template": "export * from './client'\nexport * from './config'\n"
                            },
                            {
                              "type": "file",
                              "name": "client.ts",
                              "template": "export class Client {\n  constructor(public config: Record<string, unknown>) {}\n  ping(): boolean { return true }\n}\n"
                            },
                            {
                              "type": "file",
                              "name": "config.ts",
                              "template": "export type ConnectorConfig = { apiKey: string }\n"
                            },
                            {
                              "type": "dir",
                              "name": "auth",
                              "children": [
                                {
                                  "type": "file",
                                  "name": "base.ts",
                                  "template": "export interface AuthStrategy { apply(headers: Record<string,string>): Record<string,string> }\n"
                                },
                                {
                                  "type": "file",
                                  "name": "apiKey.ts",
                                  "template": "import type { AuthStrategy } from './base'\nexport class ApiKeyAuth implements AuthStrategy {\n  constructor(private apiKey: string) {}\n  apply(headers: Record<string,string>) { return { ...headers, Authorization: `Bearer ${this.apiKey}` } }\n}\n"
                                },
                                {
                                  "type": "file",
                                  "name": "oauth2.ts",
                                  "template": "export {}\n"
                                }
                              ]
                            },
                            {
                              "type": "dir",
                              "name": "lib",
                              "children": [
                                {
                                  "type": "file",
                                  "name": "paginate.ts",
                                  "template": "export type HttpResponseEnvelope<T> = { data: T }\n\nexport type SendFn = <T = any>(args: {\n  method: 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE';\n  path: string;\n  query?: Record<string, any>;\n  headers?: Record<string, string>;\n  body?: unknown;\n  operation?: string;\n}) => Promise<HttpResponseEnvelope<T>>\n\nexport async function* paginateCursor<T = any>(params: {\n  send: SendFn;\n  path: string;\n  query?: Record<string, any>;\n  pageSize?: number;\n  extractItems?: (res: any) => T[];\n  extractNextCursor?: (res: any) => string | undefined;\n}) {\n  const extractItems = params.extractItems ?? ((res: any) => (res?.results ?? []) as T[])\n  const extractNext = params.extractNextCursor ?? ((res: any) => res?.paging?.next?.after as string | undefined)\n  let after: string | undefined = params.query?.after as string | undefined\n  const limit = params.pageSize ?? (params.query?.limit as number | undefined) ?? 100\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    const res = await params.send<any>({ method: 'GET', path: params.path, query: { ...(params.query ?? {}), limit, after }, operation: 'paginate' })\n    const items = extractItems(res.data)\n    yield items\n    const next = extractNext(res.data)\n    if (!next) break\n    after = next\n  }\n}\n"
                                },
                                {
                                  "type": "file",
                                  "name": "make-resource.ts",
                                  "template": "import { paginateCursor, type SendFn } from './paginate'\n\nexport function makeCrudResource<TItem, TListResponse, TSingleResponse>(objectPath: string, send: SendFn) {\n  const api = {\n    list: (params?: { properties?: string[]; limit?: number; after?: string }) => {\n      const query: Record<string, any> = {}\n      if (params?.properties?.length) query.properties = params.properties.join(',')\n      if (params?.limit) query.limit = params.limit\n      if (params?.after) query.after = params.after\n      return send<TListResponse>({ method: 'GET', path: objectPath, query })\n    },\n    get: (params: { id: string; properties?: string[] }) => {\n      const query: Record<string, any> = {}\n      if (params?.properties?.length) query.properties = params.properties.join(',')\n      return send<TSingleResponse>({ method: 'GET', path: `${objectPath}/${params.id}`, query })\n    },\n    streamAll: async function* (params?: { properties?: string[]; pageSize?: number }) {\n      const query: Record<string, any> = {}\n      if (params?.properties?.length) query.properties = params.properties.join(',')\n      for await (const items of paginateCursor<TItem>({ send, path: objectPath, query, pageSize: params?.pageSize })) {\n        for (const item of items) yield item\n      }\n    },\n    getAll: async (params?: { properties?: string[]; pageSize?: number; maxItems?: number }) => {\n      const results: TItem[] = []\n      for await (const item of api.streamAll({ properties: params?.properties, pageSize: params?.pageSize })) {\n        results.push(item)\n        if (params?.maxItems && results.length >= params.maxItems) break\n      }\n      return results\n    },\n  }\n  return api\n}\n"
                                },
                                {
                                  "type": "file",
                                  "name": "hooks.ts",
                                  "template": "export type RequestOptions = {\n  method: 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE'\n  path: string\n  query?: Record<string, any>\n  headers?: Record<string, string>\n  body?: unknown\n  timeoutMs?: number\n  operation?: string\n}\n\nexport type ResponseMeta = {\n  timestamp: number\n  durationMs: number\n  retryCount: number\n  requestId?: string\n}\n\nexport type ResponseEnvelope<T> = {\n  data: T\n  status?: number\n  headers?: Record<string, string>\n  meta?: ResponseMeta\n}\n\nexport type HookContext = {\n  type: 'beforeRequest' | 'afterResponse' | 'onError' | 'onRetry'\n  request?: RequestOptions\n  response?: ResponseEnvelope<any>\n  error?: unknown\n  metadata?: Record<string, any>\n  attempt?: number\n}\n\nexport type Hook = (ctx: HookContext) => void | Promise<void>\n\nexport type Hooks = {\n  beforeRequest?: Hook[]\n  afterResponse?: Hook[]\n  onError?: Hook[]\n  onRetry?: Hook[]\n}\n\nexport async function runHooks(hooks: Hook[] | undefined, ctx: HookContext): Promise<void> {\n  for (const hook of hooks ?? []) {\n    // eslint-disable-next-line no-await-in-loop\n    await hook(ctx)\n  }\n}\n"
                                },
                                {
                                  "type": "file",
                                  "name": "send.ts",
                                  "template": "import type { Hooks, RequestOptions, ResponseEnvelope } from './hooks'\nimport { runHooks } from './hooks'\n\nexport type DoRequest = <T = any>(req: RequestOptions) => Promise<ResponseEnvelope<T>>\n\nexport type RetryConfig = {\n  maxAttempts?: number\n  initialDelayMs?: number\n  maxDelayMs?: number\n  backoffMultiplier?: number\n  retryableStatusCodes?: number[]\n  respectRetryAfter?: boolean\n}\n\nfunction sleep(ms: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, ms))\n}\n\nfunction calcDelay(attempt: number, cfg: Required<Pick<RetryConfig, 'initialDelayMs' | 'maxDelayMs' | 'backoffMultiplier'>>): number {\n  const exp = cfg.initialDelayMs * Math.pow(cfg.backoffMultiplier, attempt - 1)\n  const bounded = Math.min(exp, cfg.maxDelayMs)\n  const jitter = bounded * (0.5 + Math.random() * 0.5)\n  return Math.floor(jitter)\n}\n\nexport function createSend({ doRequest, hooks, retry }: { doRequest: DoRequest; hooks?: Hooks; retry?: RetryConfig }) {\n  const retryCfg: Required<RetryConfig> = {\n    maxAttempts: retry?.maxAttempts ?? 3,\n    initialDelayMs: retry?.initialDelayMs ?? 1000,\n    maxDelayMs: retry?.maxDelayMs ?? 30000,\n    backoffMultiplier: retry?.backoffMultiplier ?? 2,\n    retryableStatusCodes: retry?.retryableStatusCodes ?? [408, 425, 429, 500, 502, 503, 504],\n    respectRetryAfter: retry?.respectRetryAfter ?? true,\n  } as Required<RetryConfig>\n\n  async function send<T = any>(req: RequestOptions): Promise<ResponseEnvelope<T>> {\n    const startedAt = Date.now()\n    let lastError: unknown\n    for (let attempt = 1; attempt <= retryCfg.maxAttempts; attempt++) {\n      try {\n        await runHooks(hooks?.beforeRequest, { type: 'beforeRequest', request: req, attempt })\n        const res = await doRequest<T>(req)\n        await runHooks(hooks?.afterResponse, { type: 'afterResponse', request: req, response: res, attempt })\n        const status = res.status ?? 200\n        if (!retryCfg.retryableStatusCodes.includes(status)) {\n          res.meta = { ...(res.meta ?? {}), timestamp: Date.now(), durationMs: Date.now() - startedAt, retryCount: attempt - 1 }\n          return res\n        }\n        lastError = new Error(`Retryable status: ${status}`)\n      } catch (err) {\n        lastError = err\n        await runHooks(hooks?.onError, { type: 'onError', request: req, error: err, attempt })\n      }\n      if (attempt < retryCfg.maxAttempts) {\n        await runHooks(hooks?.onRetry, { type: 'onRetry', request: req, error: lastError, attempt })\n        const delay = calcDelay(attempt, { initialDelayMs: retryCfg.initialDelayMs, maxDelayMs: retryCfg.maxDelayMs, backoffMultiplier: retryCfg.backoffMultiplier })\n        await sleep(delay)\n        continue\n      }\n      break\n    }\n    throw lastError ?? new Error('Request failed')\n  }\n\n  return send\n}\n"
                                }
                              ]
                            },
                            {
                              "type": "dir",
                              "name": "{resource}",
                              "children": [
                                {
                                  "type": "file",
                                  "name": "index.ts",
                                  "template": "import { makeCrudResource } from '../lib/make-resource'\nimport type { SendFn } from '../lib/paginate'\nimport type { Model } from './model'\n\nexport const createResource = (send: SendFn) => makeCrudResource<Model, any, any>('/{resource}', send)\n"
                                },
                                {
                                  "type": "file",
                                  "name": "model.ts",
                                  "template": "export interface Model {\n  // Define your resource model fields\n  [key: string]: unknown\n}\n"
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "type": "dir",
                          "name": "tests",
                          "children": [
                            {
                              "type": "file",
                              "name": "client.test.ts",
                              "template": "import { describe, it, expect } from 'vitest'\nimport { Client } from '../src/client'\n\ndescribe('client', () => {\n  it('ping', () => {\n    expect(new Client({}).ping()).toBe(true)\n  })\n})\n"
                            }
                          ]
                        },
                        {
                          "type": "dir",
                          "name": "examples",
                          "children": [
                            {
                              "type": "file",
                              "name": "basic-usage.ts",
                              "template": "import { Client } from './src/client'\nconsole.log(new Client({}).ping())\n"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}